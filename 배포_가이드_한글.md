# 🚀 Base Revolt 완전 배포 가이드 (한글)

> **미니앱 테스트를 위한 전체 시스템 배포 가이드**

## 📌 시작하기 전에

### 필요한 것들
- ✅ GitHub 계정
- ✅ Render 계정 (무료) - https://render.com
- ✅ Vercel 계정 (무료) - https://vercel.com
- ✅ Coinbase Developer 계정 - https://portal.cdp.coinbase.com
- ✅ MetaMask 지갑 + Base ETH (약 $10)
- ✅ Arduino IDE 설치
- ✅ Node.js 18+ 설치

### 하드웨어 (나중에 준비해도 됨)
- ESP32-CAM
- L298N 모터 드라이버
- RC카 섀시 + 모터
- FTDI 어댑터
- 배터리

---

## 🔥 1단계: GitHub 리포지토리 준비

### 1-1. Git 초기화
```powershell
cd "C:\dev\Base Revolt"
git init
git add .
git commit -m "Initial commit: Base Revolt MVP"
```

### 1-2. GitHub에 푸시
1. GitHub.com 접속 → 새 리포지토리 생성
2. 리포지토리 이름: `base-revolt`
3. Public 또는 Private 선택
4. **Create repository**

```powershell
git remote add origin https://github.com/YOUR_USERNAME/base-revolt.git
git branch -M main
git push -u origin main
```

✅ **완료!** GitHub에 코드가 올라갔습니다.

---

## 🌐 2단계: Render에 WebSocket 서버 배포

### 2-1. Render 계정 생성
1. https://render.com 접속
2. **Sign Up** → GitHub로 로그인
3. GitHub 연동 승인

### 2-2. 새 Web Service 생성
1. Dashboard → **New +** → **Web Service**
2. GitHub 리포지토리 연결 (`base-revolt`)
3. 다음 설정 입력:

| 항목 | 값 |
|------|-----|
| **Name** | `base-revolt-server` |
| **Region** | `Singapore` (또는 가장 가까운 지역) |
| **Branch** | `main` |
| **Root Directory** | `server` ⚠️ 중요! |
| **Runtime** | `Node` |
| **Build Command** | `npm install` |
| **Start Command** | `npm start` |
| **Instance Type** | **Free** |

4. **Create Web Service** 클릭

### 2-3. 배포 완료 대기
- 2-3분 소요
- **Logs** 탭에서 진행 상황 확인
- "Your service is live 🎉" 메시지 대기

### 2-4. URL 복사
상단에 표시된 URL 복사:
```
https://base-revolt-server-xxxx.onrender.com
```

📝 **메모장에 저장!** (나중에 사용)

### 2-5. 동작 확인
브라우저에서 접속:
```
https://base-revolt-server-xxxx.onrender.com
```

다음 JSON이 보이면 성공:
```json
{
  "status": "running",
  "service": "Base Revolt WebSocket Server",
  "clients": {
    "rcCar": "disconnected",
    "webUsers": 0
  }
}
```

✅ **2단계 완료!**

---

## 💎 3단계: Base 메인넷에 스마트 컨트랙트 배포

### 3-1. MetaMask에 Base 네트워크 추가

1. MetaMask 열기
2. 네트워크 드롭다운 → **네트워크 추가** → **수동 추가**
3. 다음 정보 입력:

| 항목 | 값 |
|------|-----|
| **네트워크 이름** | `Base Mainnet` |
| **RPC URL** | `https://mainnet.base.org` |
| **체인 ID** | `8453` |
| **통화 기호** | `ETH` |
| **탐색기 URL** | `https://basescan.org` |

4. **저장** 클릭

### 3-2. Base ETH 준비

**방법 1: Coinbase에서 전송**
- Coinbase 앱 → Base 네트워크 선택 → 전송

**방법 2: Base 브릿지**
- https://bridge.base.org
- Ethereum → Base로 브릿지
- 필요 금액: **약 $5-10** (가스비 포함)

### 3-3. Remix IDE에서 컨트랙트 배포

#### Step 1: Remix 접속
https://remix.ethereum.org

#### Step 2: 파일 생성
1. 좌측 **File Explorer**
2. 우클릭 → **New File**
3. 파일명: `TicketSale.sol`

#### Step 3: 코드 복사
프로젝트의 `contracts/TicketSale.sol` 내용을 복사해서 붙여넣기

#### Step 4: 컴파일
1. 좌측 **Solidity Compiler** 탭 (3번째 아이콘)
2. Compiler 버전: **0.8.20** 이상 선택
3. **Compile TicketSale.sol** 버튼 클릭
4. 녹색 체크 표시 확인 ✅

#### Step 5: 배포
1. 좌측 **Deploy & Run Transactions** 탭 (4번째 아이콘)
2. **Environment**: `Injected Provider - MetaMask` 선택
3. MetaMask 팝업 → **Base Mainnet** 선택 → 연결
4. **Contract**: `TicketSale` 선택 확인
5. 🔴 **Deploy** 버튼 클릭
6. MetaMask 팝업 → 가스비 확인 → **확인** 클릭

#### Step 6: 배포 완료
- 하단 콘솔에서 진행 상황 확인
- 30초~1분 소요
- **Deployed Contracts** 섹션에서 컨트랙트 확인

#### Step 7: 컨트랙트 주소 복사
```
예: 0x1234567890abcdef1234567890abcdef12345678
```

📝 **메모장에 저장!**

#### Step 8: Basescan에서 확인
```
https://basescan.org/address/YOUR_CONTRACT_ADDRESS
```

✅ **3단계 완료!**

---

## 🔑 4단계: Coinbase OnchainKit API Key 발급

### 4-1. Developer Portal 접속
https://portal.cdp.coinbase.com/

### 4-2. 프로젝트 생성
1. **로그인** (Coinbase 계정)
2. **Create Project** 또는 **New Project**
3. 프로젝트 이름: `Base Revolt`
4. **Create** 클릭

### 4-3. API Key 발급
1. 프로젝트 대시보드
2. **API Keys** 또는 **OnchainKit** 섹션
3. **Create API Key** 클릭
4. Key 이름: `Base Revolt Production`
5. **Create** 클릭

### 4-4. API Key 복사
```
예: 6Jb2xK...
```

⚠️ **한 번만 표시됩니다!** 📝 메모장에 안전하게 저장!

✅ **4단계 완료!**

---

## 🤖 5단계: ESP32-CAM 펌웨어 업로드

### 5-1. Arduino IDE 설정

#### ESP32 보드 추가
1. Arduino IDE → **파일** → **환경설정**
2. **추가 보드 매니저 URLs**에 추가:
```
https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json
```
3. **확인** 클릭
4. **도구** → **보드** → **보드 매니저**
5. 검색: `esp32`
6. **esp32 by Espressif Systems** 설치

#### 라이브러리 설치
1. **스케치** → **라이브러리 포함하기** → **라이브러리 관리**
2. 다음 라이브러리 설치:

**WebSockets** by Markus Sattler
- 검색: `WebSockets`
- 버전: 2.3.6 이상

**ArduinoJson** by Benoit Blanchon
- 검색: `ArduinoJson`
- 버전: 6.21.0 이상

### 5-2. 코드 수정

`hardware/esp32_rc_car.ino` 파일 열기

**수정할 부분 (22-27번 줄):**

```cpp
// WiFi 설정 (본인 WiFi로 변경 필요)
const char* ssid = "YOUR_WIFI_SSID";              // ← 본인 WiFi 이름
const char* password = "YOUR_WIFI_PASSWORD";      // ← 본인 WiFi 비밀번호

// WebSocket 서버 설정 (Render 배포 후 변경)
const char* ws_host = "base-revolt-server-xxxx.onrender.com";  // ← Render URL (도메인만!)
const int ws_port = 443;
const char* ws_path = "/";
const bool ws_ssl = true;
```

**⚠️ 주의사항:**
- `ws_host`는 **도메인만** 입력 (https:// 제거)
- 예: `base-revolt-server-xxxx.onrender.com`

### 5-3. 보드 설정

1. **도구** → **보드** → **ESP32 Arduino** → **AI Thinker ESP32-CAM**
2. **도구** → **Upload Speed**: `115200`
3. **도구** → **Flash Frequency**: `80MHz`
4. **도구** → **Flash Mode**: `QIO`
5. **도구** → **Partition Scheme**: `Huge APP (3MB No OTA)`

### 5-4. 하드웨어 연결 (FTDI)

ESP32-CAM에는 USB 포트가 없어서 FTDI 어댑터가 필요합니다:

```
FTDI          ESP32-CAM
-----         ---------
TX      →     RX (U0R)
RX      →     TX (U0T)
GND     →     GND
5V      →     5V
```

**부팅 모드 진입 (업로드 시만):**
- **GPIO 0 핀을 GND에 연결**
- 전원 재인가 또는 리셋 버튼 누르기

### 5-5. 업로드

1. **도구** → **포트** → USB 포트 선택 (COM3, COM4 등)
2. 🔴 **업로드** 버튼 클릭 (→ 아이콘)
3. "Connecting..." 메시지 나오면 **리셋 버튼** 누르기
4. 업로드 진행 (1-2분)
5. "Hard resetting via RTS pin..." 메시지 확인

### 5-6. 업로드 완료 후

1. **GPIO 0과 GND 연결 제거**
2. **리셋 버튼** 누르기
3. **도구** → **시리얼 모니터** 열기
4. **Baud Rate**: `115200` 선택

### 5-7. 동작 확인

시리얼 모니터에서 다음 메시지 확인:

```
=== Base Revolt RC Car Starting ===
Connecting to WiFi: YOUR_WIFI_SSID
...
WiFi Connected!
IP Address: 192.168.1.xxx
Camera initialized successfully
Motors initialized
Setting up WebSocket...
[WS] Connected to server
```

✅ **5단계 완료!**

---

## 🌍 6단계: Vercel에 프론트엔드 배포

### 6-1. 설정 파일 업데이트

#### contracts.js 수정
`frontend/src/config/contracts.js` 파일 열기:

```javascript
// 3단계에서 복사한 컨트랙트 주소로 변경
export const TICKET_CONTRACT_ADDRESS = "0x1234567890abcdef1234567890abcdef12345678";

// 2단계에서 복사한 Render URL로 변경 (wss:// 사용!)
export const WS_SERVER_URL = "wss://base-revolt-server-xxxx.onrender.com";
```

**⚠️ 주의:** WebSocket은 `wss://` 사용 (https의 ws 버전)

#### Git 커밋 & 푸시
```powershell
cd "C:\dev\Base Revolt"
git add frontend/src/config/contracts.js
git commit -m "Update contract address and WebSocket URL"
git push
```

### 6-2. Vercel 계정 생성

1. https://vercel.com 접속
2. **Sign Up** → GitHub로 로그인
3. GitHub 연동 승인

### 6-3. 프로젝트 Import

1. Dashboard → **Add New...** → **Project**
2. **Import Git Repository** 섹션
3. 리포지토리 선택: `base-revolt`
4. **Import** 클릭

### 6-4. 프로젝트 설정

| 항목 | 값 |
|------|-----|
| **Framework Preset** | `Vite` (자동 감지됨) |
| **Root Directory** | `frontend` ⚠️ 중요! |
| **Build Command** | `npm run build` |
| **Output Directory** | `dist` |
| **Install Command** | `npm install` |

### 6-5. 환경 변수 추가

**Environment Variables** 섹션에서:

| Name | Value |
|------|-------|
| `VITE_ONCHAINKIT_API_KEY` | 4단계에서 복사한 API Key |
| `VITE_WS_SERVER_URL` | `wss://base-revolt-server-xxxx.onrender.com` |

각 변수마다:
1. **Name** 입력
2. **Value** 입력
3. **Add** 클릭

### 6-6. 배포

1. 🔴 **Deploy** 버튼 클릭
2. 배포 진행 (2-3분)
3. 진행 상황 확인
4. "Congratulations!" 메시지 확인

### 6-7. 배포 URL 확인

```
예: https://base-revolt.vercel.app
```

**Visit** 버튼 클릭하여 접속 확인

✅ **6단계 완료!**

---

## 🧪 7단계: 전체 시스템 통합 테스트

### 7-1. 서버 상태 확인

**Render 서버 확인:**
```
https://base-revolt-server-xxxx.onrender.com
```

JSON 응답 확인:
```json
{
  "status": "running",
  "clients": {
    "rcCar": "connected",    ← ESP32가 연결되면 "connected"
    "webUsers": 0
  }
}
```

### 7-2. 웹앱 접속

1. Vercel URL 접속: `https://base-revolt.vercel.app`
2. 홈 페이지 로딩 확인
3. UI가 정상적으로 보이는지 확인

### 7-3. 지갑 연결 테스트

1. 우측 상단 **Connect Wallet** 클릭
2. MetaMask 팝업 → 계정 선택
3. **Connect** 클릭
4. 연결 성공 확인 (지갑 주소 표시)

### 7-4. RC카 상태 확인

상단에 RC카 상태 표시 확인:
- 🟢 **RC카 연결됨** ← ESP32가 서버에 연결됨
- 🔴 **RC카 연결 안됨** ← ESP32 확인 필요

### 7-5. 데모 모드 테스트 (하드웨어 없이)

1. **데모 체험하기** 버튼 클릭
2. 플레이 페이지 이동
3. 조종 UI 확인:
   - W/A/S/D 키 눌러보기
   - 화면 버튼 클릭해보기
4. 타이머 작동 확인

### 7-6. 실제 티켓 구매 테스트

1. 홈으로 복귀
2. **티켓 구매하기** ($0.5) 클릭
3. MetaMask 팝업:
   - 금액 확인: ~0.0002 ETH
   - 가스비 확인
   - **확인** 클릭
4. 트랜잭션 대기 (10-30초)
5. 자동으로 플레이 페이지 이동

### 7-7. 실제 RC카 조종 (하드웨어 있을 때)

#### 하드웨어 조립
```
ESP32-CAM          L298N
---------          ------
GPIO 12    →       IN1 (좌측 모터)
GPIO 13    →       IN2 (좌측 모터)
GPIO 14    →       IN3 (우측 모터)
GPIO 15    →       IN4 (우측 모터)
5V         →       VCC
GND        →       GND

L298N              DC 모터
------             -------
OUT1, OUT2  →      좌측 모터
OUT3, OUT4  →      우측 모터
```

#### 전원 연결
- ESP32-CAM: 5V 전원 (USB 또는 배터리)
- L298N: 7-12V 배터리

#### 조종 테스트
1. 영상 스트림 확인 (ESP32 카메라 영상)
2. 키보드 조종:
   - **W**: 전진
   - **S**: 후진
   - **A**: 좌회전
   - **D**: 우회전
3. 터치 조종: 화면 버튼 클릭
4. RC카가 실제로 움직이는지 확인

### 7-8. 타이머 테스트
- 10분 카운트다운 작동 확인
- 시간 종료 시 자동으로 홈으로 이동

---

## ✅ 최종 체크리스트

### 서버
- [ ] Render 서버 배포 완료
- [ ] 서버 상태 API 작동 (`/` 경로)
- [ ] WebSocket 서버 작동

### 스마트 컨트랙트
- [ ] Base 메인넷에 배포 완료
- [ ] Basescan에서 확인 가능
- [ ] 컨트랙트 주소 복사 완료

### API & 인증
- [ ] OnchainKit API Key 발급
- [ ] 환경 변수에 설정 완료

### 하드웨어 (선택)
- [ ] ESP32 펌웨어 업로드 완료
- [ ] WiFi 연결 확인
- [ ] WebSocket 서버 연결 확인
- [ ] 하드웨어 조립 완료

### 프론트엔드
- [ ] Vercel 배포 완료
- [ ] 웹앱 접속 확인
- [ ] 지갑 연결 작동
- [ ] 티켓 구매 작동
- [ ] RC카 조종 작동

---

## 🐛 문제 해결 (Troubleshooting)

### 1. ESP32가 WiFi에 연결 안됨
**증상:** 시리얼 모니터에서 계속 "..." 출력

**해결:**
- SSID/비밀번호 재확인 (대소문자 구분)
- 2.4GHz WiFi인지 확인 (5GHz 불가)
- 공유기 가까이에서 테스트
- 한글 SSID는 피하기

### 2. ESP32가 서버에 연결 안됨
**증상:** "WiFi connected" 이후 WebSocket 연결 실패

**해결:**
- Render URL이 올바른지 확인 (도메인만, https:// 제외)
- `ws_ssl = true` 설정 확인
- Render 서버가 Running 상태인지 확인
- 방화벽 확인

### 3. 웹에서 RC카가 안보임
**증상:** "RC카 연결 안됨" 표시

**해결:**
- Render 서버 상태 API 접속 확인
- ESP32 시리얼 모니터에서 "[WS] Connected" 확인
- WebSocket URL이 `wss://`로 시작하는지 확인

### 4. 카메라 영상이 안보임
**증상:** 검은 화면 또는 영상 없음

**해결:**
- ESP32에 5V 전원 공급 확인 (3.3V 부족)
- 카메라 리본 케이블 재연결
- 시리얼 모니터에서 "Camera initialized" 확인
- ESP32 리셋

### 5. 모터가 안움직임
**증상:** 명령은 전송되지만 모터 무반응

**해결:**
- L298N 연결 재확인 (핀 번호)
- 모터 극성 바꿔보기 (OUT1 ↔ OUT2)
- 배터리 전압 확인 (7-12V)
- L298N 점퍼 설정 확인 (ENA, ENB)

### 6. 지갑 연결 안됨
**증상:** MetaMask 팝업 안뜸

**해결:**
- MetaMask 설치 확인
- Base 네트워크 추가 확인
- OnchainKit API Key 확인
- 브라우저 콘솔 에러 확인 (F12)

### 7. 티켓 구매 실패
**증상:** 트랜잭션 실패 또는 에러

**해결:**
- Base ETH 잔액 충분한지 확인 (가스비 포함)
- MetaMask에서 Base Mainnet 선택 확인
- 컨트랙트 주소 재확인
- Basescan에서 컨트랙트 상태 확인

### 8. Vercel 배포 실패
**증상:** 빌드 에러

**해결:**
- Root Directory가 `frontend`인지 확인
- 환경 변수 올바르게 입력했는지 확인
- GitHub에 최신 코드 푸시 확인
- Vercel 빌드 로그 확인

### 9. Render 서버가 자꾸 잠듦
**증상:** 무료 티어 15분 비활성 시 sleep

**해결:**
- 정상입니다! 첫 요청 시 재시작 (30초 소요)
- 유료 플랜으로 업그레이드 ($7/월)
- 또는 Ping 서비스 사용 (예: UptimeRobot)

---

## 📊 시스템 아키텍처

```
┌─────────────────────────┐
│   사용자 브라우저        │
│   (MetaMask + Web3)     │
└────────┬────────────────┘
         │ HTTPS
         ↓
┌─────────────────────────┐
│   React 프론트엔드       │
│   (Vercel)              │
│   - OnchainKit          │
│   - wagmi               │
└────────┬────────────────┘
         │ WebSocket (WSS)
         ↓
┌─────────────────────────┐
│   WebSocket 서버         │
│   (Render - Node.js)    │
│   - 클라이언트 관리      │
│   - 영상 릴레이         │
└────────┬────────────────┘
         │ WebSocket (WSS)
         ↓
┌─────────────────────────┐
│   ESP32-CAM RC Car      │
│   - 카메라 스트리밍      │
│   - 모터 제어           │
└────────┬────────────────┘
         │ GPIO
         ↓
┌─────────────────────────┐
│   L298N 모터 드라이버    │
│   → DC 모터 (RC카)      │
└─────────────────────────┘

┌─────────────────────────┐
│   Base Mainnet          │
│   (Blockchain)          │
│   - TicketSale.sol      │
└─────────────────────────┘
```

---

## 🎉 축하합니다!

**Base Revolt MVP 배포 완료!** 🚀

이제 다음을 할 수 있습니다:
- ✅ Web3 지갑으로 티켓 구매
- ✅ 웹 브라우저에서 RC카 조종
- ✅ 실시간 카메라 영상 확인
- ✅ Base 네트워크에서 결제

### 다음 단계

1. **친구 초대**: URL 공유하고 테스트
2. **성능 최적화**: 영상 품질, 지연시간 개선
3. **기능 추가**:
   - 멀티플레이어 대기열
   - NFT 소유권 시스템
   - 리더보드
   - AR 기능

### 공유하기

SNS에 공유하고 자랑하세요!

```
🚗 Base Revolt - Web3 RC카 원격 조종 미니앱 완성!

Base 네트워크에서 티켓 구매하고
브라우저에서 실제 RC카를 조종할 수 있어요!

🔗 [당신의 Vercel URL]

#Base #Web3 #Coinbase #OnchainKit #ESP32
```

---

## 📞 도움이 필요하세요?

- **GitHub Issues**: 버그 리포트 및 기능 제안
- **Discord**: 커뮤니티 채팅
- **Email**: 기술 지원

**Happy Building! Let's Revolt! 🚗💨**

